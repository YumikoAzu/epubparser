(window.webpackJsonpclient=window.webpackJsonpclient||[]).push([[0],{33:function(e,t,n){e.exports=n(84)},38:function(e,t,n){},39:function(e,t,n){},66:function(e,t){},84:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(31),i=n.n(o),c=(n(38),n(0)),s=n(11),u=n(3),l=n(2),h=n(4),p=(n(39),n(5)),f=n.n(p),v=n(12),b=n(6),y=n(8),k=function e(){Object(c.a)(this,e)},d=function e(t){Object(c.a)(this,e),this.href=t&&t.href,this.type=t&&t.type},g=function e(t){Object(c.a)(this,e),this.canonical=t&&t.canonical,this.cfiBase=t&&t.cfiBase,this.href=t&&t.href,this.idref=t&&t.idref,this.index=t&&t.index,this.linear=t&&t.linear,this.url=t&&t.url},m=n(13),w=n.n(m),x=n(32),O=n.n(x),j=function e(t){Object(c.a)(this,e),this.className=t&&t.className,this.style=t&&t.style,this.type=t&&t.type},B=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).itemType="container",n.children=e&&e.children,n}return Object(h.a)(t,e),t}(j),R=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).itemType="text",n.content=e&&e.content,n}return Object(h.a)(t,e),t}(j),L=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).itemType="image",n.src=e&&e.src,n.active=e&&e.active,n.alt=e&&e.alt,n}return Object(h.a)(t,e),t}(j),C=function(){function e(){var t=this;Object(c.a)(this,e),Object(b.a)(function(){console.log("baseURL",t.baseURL)}),this.bookMap=new Map,y.config({driver:y.WEBSQL,name:"epubfile",version:1,description:"save epub file info"})}return Object(s.a)(e,[{key:"openBook",value:function(e){var t=this;console.log(e);var n=JSON.parse(e),r=n.ip,a=n.port,o=n.bookKey,i=n.bookPath,c=n.bookUnzipPath;this.baseURL="http://".concat(r,":").concat(a),this.queryBook(o,i,c).then(function(e){console.log("\u4e66\u7c4d\u4fe1\u606f",e),t.onOpenResult(!0,o,JSON.stringify(e))},function(e){console.log("\u4e66\u7c4d\u6253\u5f00\u5931\u8d25",e),t.onOpenResult(!1,o,JSON.stringify(e))}).catch(function(e){console.log("\u4e66\u7c4d\u6253\u5f00\u5931\u8d25",e),t.onOpenResult(!1,o,JSON.stringify(e))})}},{key:"loadChapter",value:function(e){var t=this;console.log(e);var n=JSON.parse(e),r=n.ip,a=n.port,o=n.bookKey,i=n.chapterIndex;this.baseURL="http://".concat(r,":").concat(a),this.queryChapter(o,i).then(function(e){console.log("\u6bb5\u843d\u5217\u8868",e),t.onChapterResult(!0,o,JSON.stringify(e))},function(e){console.log("\u7ae0\u8282\u83b7\u53d6\u5931\u8d25",e),t.onChapterResult(!1,o,JSON.stringify(e))}).catch(function(e){console.log("\u7ae0\u8282\u83b7\u53d6\u5931\u8d25",e),t.onChapterResult(!1,o,JSON.stringify(e))})}},{key:"queryBook",value:function(){var e=Object(v.a)(f.a.mark(function e(t,n,r){var a,o,i;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getBookFromCache(t);case 2:if(!(a=e.sent)){e.next=5;break}return e.abrupt("return",a);case 5:return o="".concat(this.provideBaseURL,"/").concat(r),e.next=8,this.createBook(o);case 8:if(!(i=e.sent)){e.next=14;break}return console.log("\u4e66\u7c4d\u5df2\u6253\u5f00",i),e.next=13,this.storeBookInfo(t,n,r,i);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getBookFromCache",value:function(){var e=Object(v.a)(f.a.mark(function e(t){var n,r;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.bookMap.get(t))){e.next=4;break}return console.log("\u547d\u4e2d\u5185\u5b58\u7f13\u5b58"),e.abrupt("return",n);case 4:return e.next=6,y.getItem(t);case 6:if(!(r=e.sent)){e.next=11;break}return console.log("\u547d\u4e2d\u6570\u636e\u5e93\u7f13\u5b58"),this.bookMap.set(t,r),e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createBook",value:function(e){var t=new window.ePub.Book;return t.open(e),t.opened}},{key:"storeBookInfo",value:function(e,t,n,r){var a=r.container,o=r.package,i=r.resources,c=r.spine,s=o.metadata,u=o.coverPath,l=o.ncxPath,h=o.navPath,p=o.uniqueIdentifier,f=i.resources,v=c.spineItems,b=new k;return b.bookKey=e,b.bookPath=t,b.bookUnzipPath=n,b.container=a,b.resources=this.rebuildResources(f),b.metadata=s,b.coverPath=u,b.navPath=h,b.ncxPath=l,b.spine=this.rebuildSpineItems(v),b.uniqueIdentifier=p,this.bookMap.set(e,b),console.log("\u4e66\u7c4d\u7f13\u5b58\u5230\u5185\u5b58"),y.setItem(e,b).then(function(){return console.log("\u4e66\u7c4d\u7f13\u5b58\u5230\u6570\u636e\u5e93"),y.getItem(e)})}},{key:"rebuildResources",value:function(e){var t=new Array,n=!0,r=!1,a=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var c=o.value;t.push(new d(c))}}catch(s){r=!0,a=s}finally{try{n||null==i.return||i.return()}finally{if(r)throw a}}return t}},{key:"rebuildSpineItems",value:function(e){var t=new Array,n=!0,r=!1,a=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var c=o.value;t.push(new g(c))}}catch(s){r=!0,a=s}finally{try{n||null==i.return||i.return()}finally{if(r)throw a}}return t}},{key:"queryChapter",value:function(){var e=Object(v.a)(f.a.mark(function e(t,n){var r,a,o,i,c,s,u,l,h,p,v,b,y,k,d,g,m,x,j,B,R,L,C,I,U,S,N,P;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getBookFromCache(t);case 2:if(!(r=e.sent)){e.next=79;break}return a=r.container,o=r.bookUnzipPath,i=r.spine,c=a.directory,s=i[n],u=s.href,l=new w.a,h=this.provideBaseURL,e.next=12,l.get("".concat(o,"/").concat(c,"/").concat(u),{},{baseURL:h});case 12:if(p=e.sent,v=p.data,b=O()(v),console.log("doc",b),!Array.isArray(b)){e.next=79;break}k=!0,d=!1,g=void 0,e.prev=20,m=b[Symbol.iterator]();case 22:if(k=(x=m.next()).done){e.next=30;break}if(!(j=x.value)||"html"!==j.type){e.next=27;break}return y=j,e.abrupt("break",30);case 27:k=!0,e.next=22;break;case 30:e.next=36;break;case 32:e.prev=32,e.t0=e.catch(20),d=!0,g=e.t0;case 36:e.prev=36,e.prev=37,k||null==m.return||m.return();case 39:if(e.prev=39,!d){e.next=42;break}throw g;case 42:return e.finish(39);case 43:return e.finish(36);case 44:if(!y){e.next=79;break}if(console.log("html node",y),B=y.props,R=B&&B.children,!Array.isArray(R)){e.next=79;break}C=!0,I=!1,U=void 0,e.prev=52,S=R[Symbol.iterator]();case 54:if(C=(N=S.next()).done){e.next=62;break}if(!(P=N.value)||"body"!==P.type){e.next=59;break}return L=P,e.abrupt("break",62);case 59:C=!0,e.next=54;break;case 62:e.next=68;break;case 64:e.prev=64,e.t1=e.catch(52),I=!0,U=e.t1;case 68:e.prev=68,e.prev=69,C||null==S.return||S.return();case 71:if(e.prev=71,!I){e.next=74;break}throw U;case 74:return e.finish(71);case 75:return e.finish(68);case 76:if(!L){e.next=79;break}return console.log("body node",L),e.abrupt("return",this.createParagraphs(L));case 79:case"end":return e.stop()}},e,this,[[20,32,36,44],[37,,39,43],[52,64,68,76],[69,,71,75]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"createParagraphs",value:function(e){if(e){var t=Array.of(),n=e.props,r=n&&n.children;if(r){var a=!0,o=!1,i=void 0;try{for(var c,s=r[Symbol.iterator]();!(a=(c=s.next()).done);a=!0){var u=c.value;t.push(this.createContainerItem(u))}}catch(l){o=!0,i=l}finally{try{a||null==s.return||s.return()}finally{if(o)throw i}}}return t}}},{key:"createContainerItem",value:function(e){var t=e.type,n=e.props,r=n&&n.className,a=n&&n.style,o=n&&n.children,i=Array.of();if("img"===t){var c=n&&n.alt,s=n&&n.active,u=n&&n.src;i.push(new L({type:t,className:r,style:a,alt:c,active:s,src:u}))}else if(Array.isArray(o)&&o.length>=1){var l=!0,h=!1,p=void 0;try{for(var f,v=o[Symbol.iterator]();!(l=(f=v.next()).done);l=!0){var b=f.value;if("string"===typeof b)i.push(new R({content:b}));else if("img"===b.type){var y=b.type,k=b.props,d=k&&k.className,g=k&&k.style,m=k&&k.alt,w=k&&k.active,x=k&&k.src;i.push(new L({type:y,className:d,style:g,alt:m,active:w,src:x}))}else i.push(this.createContainerItem(b))}}catch(O){h=!0,p=O}finally{try{l||null==v.return||v.return()}finally{if(h)throw p}}}return new B({type:t,className:r,style:a,children:i})}},{key:"onOpenResult",value:function(e,t,n){var r=new w.a,a=this.provideBaseURL;r.post("/book/openResult",{success:e,bookKey:t,data:n},{baseURL:a}).then(function(e){console.log(e.data)}).catch(function(e){console.log(e)})}},{key:"onChapterResult",value:function(e,t,n){var r=new w.a,a=this.provideBaseURL;r.post("/book/chapterResult",{success:e,bookKey:t,data:n},{baseURL:a}).then(function(e){console.log(e.data)}).catch(function(e){console.log(e)})}},{key:"provideBaseURL",get:function(){return this.baseURL}},{key:"provideBookMap",get:function(){return this.bookMap}}]),e}();Object(b.c)(C,{baseURL:b.d,bookMap:b.d,provideBaseURL:b.b,provideBookMap:b.b});var I=C,U=function(e){function t(e){var n;return Object(c.a)(this,t),n=Object(u.a)(this,Object(l.a)(t).call(this,e)),window.jsBridge=new I,n.onLife(1),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"onLife",value:function(e){window.platform&&window.platform.onLife&&window.platform.onLife(e)}},{key:"componentWillMount",value:function(){this.onLife(2)}},{key:"render",value:function(){var e=this;return this.onLife(3),a.a.createElement("div",{className:"andserver"},a.a.createElement("div",null,"this is andserver page"),a.a.createElement("div",null,a.a.createElement("input",{onChange:function(t){e.changeBookKey(t)},placeholder:"\u8f93\u5165\u56fe\u4e66Key"})),a.a.createElement("button",{onClick:function(){e.openBook()}},"\u6253\u5f00\u56fe\u4e66"),a.a.createElement("div",null,a.a.createElement("input",{onChange:function(t){e.changeChapterIndex(t)},placeholder:"\u8f93\u5165\u7ae0\u8282\u7f16\u53f7"})),a.a.createElement("button",{onClick:function(){e.loadChapter()}},"\u52a0\u8f7d\u7ae0\u8282"))}},{key:"openBook",value:function(){var e=this.bookKey,t="/resources/server/book/".concat(this.bookKey),n="/resources/server/book/unzip/".concat(this.bookKey,"/");window.jsBridge.openBook(JSON.stringify({ip:"192.168.56.156",port:9595,bookKey:e,bookPath:t,bookUnzipPath:n}))}},{key:"loadChapter",value:function(){var e=this.bookKey,t=this.chapterIndex;window.jsBridge.loadChapter(JSON.stringify({ip:"192.168.56.156",port:9595,bookKey:e,chapterIndex:t}))}},{key:"changeBookKey",value:function(e){this.bookKey=e.target.value}},{key:"changeChapterIndex",value:function(e){this.chapterIndex=e.target.value}},{key:"componentDidMount",value:function(){this.onLife(4)}},{key:"componentWillUnmount",value:function(){this.onLife(5),delete window.jsBridge}}]),t}(r.Component);i.a.render(a.a.createElement(U,null),document.getElementById("root"))}},[[33,1,2]]]);
//# sourceMappingURL=main.f3ffc83b.chunk.js.map